<div class="card-wrapper product-card-wrapper">
  <div class="card card--product" data-product-id="{{ product.id }}">
    <div class="card__inner">
      <!-- Media -->
      <div class="card__media">
        {%- if product.featured_media -%}
          <div class="media media--hover-effect">
            <a href="{{ product.url }}" class="media__link" aria-label="{{ product.title | escape }}">
              <!-- Badges -->
              <div class="card__badge">
                {%- if product.available == false -%}
                  <span class="badge badge--sold-out">{{ 'products.product.sold_out' | t }}</span>
                {%- elsif product.compare_at_price > product.price -%}
                  {%- assign discount = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price -%}
                  <span class="badge badge--sale">-{{ discount }}%</span>
                {%- elsif product.tags contains 'new' -%}
                  <span class="badge badge--new">{{ 'products.product.new' | t }}</span>
                {%- endif -%}
              </div>

              <!-- Primary Image -->
              {{ product.featured_media | image_url: width: 500 | image_tag:
                widths: '165, 360, 535, 750, 1070',
                sizes: '(min-width: 1200px) calc((100vw - 10rem) / 4), (min-width: 990px) calc((100vw - 10rem) / 3), (min-width: 750px) calc((100vw - 10rem) / 2), calc(100vw - 3rem)',
                loading: 'lazy',
                class: 'motion-reduce primary-image',
                alt: product.featured_media.alt | escape
              }}
              
              <!-- Secondary Image on Hover -->
              {%- if product.media[1] != nil and show_secondary_image -%}
                {{ product.media[1] | image_url: width: 500 | image_tag:
                  widths: '165, 360, 535, 750, 1070',
                  sizes: '(min-width: 1200px) calc((100vw - 10rem) / 4), (min-width: 990px) calc((100vw - 10rem) / 3), (min-width: 750px) calc((100vw - 10rem) / 2), calc(100vw - 3rem)',
                  loading: 'lazy',
                  class: 'motion-reduce hover-image',
                  alt: product.media[1].alt | escape
                }}
              {%- endif -%}
            </a>
          </div>
        {%- else -%}
          <div class="card__media">
            {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
          </div>
        {%- endif -%}
        
        <!-- Quick Actions -->
        {%- if show_quick_add or settings.enable_wishlist -%}
          <div class="card__quick-actions">
            {%- if show_quick_add -%}
              {%- if product.has_only_default_variant -%}
                <product-form>
                  {%- form 'product', product, id: 'QuickAdd-{{ product.id }}', class: 'form quick-add-form', novalidate: 'novalidate' -%}
                    <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                    <button
                      type="submit"
                      name="add"
                      class="quick-add__submit button button--secondary"
                      aria-label="Add {{ product.title | escape }} to cart"
                      {% unless product.available %}disabled{% endunless %}
                    >
                      {%- if product.available -%}
                        {{ 'products.product.add_to_cart' | t }}
                      {%- else -%}
                        {{ 'products.product.sold_out' | t }}
                      {%- endif -%}
                    </button>
                  {%- endform -%}
                </product-form>
              {%- else -%}
                <a href="{{ product.url }}" class="quick-add__submit button button--secondary">
                  {{ 'products.product.choose_options' | t }}
                </a>
              {%- endif -%}
            {%- endif -%}
          </div>
        {%- endif -%}
      </div>
      
      <!-- Content -->
      <div class="card__content">
        <div class="card__information">
          {%- if show_vendor -%}
            <span class="card__vendor visually-hidden">{{ 'accessibility.vendor' | t }}</span>
            <div class="caption-with-letter-spacing">{{ product.vendor }}</div>
          {%- endif -%}
          
          <h3 class="card__heading">
            <a href="{{ product.url }}" class="full-unstyled-link">
              {{ product.title | escape }}
            </a>
          </h3>
          
          {%- if show_rating and product.metafields.reviews.rating.value != blank -%}
            {%- liquid
              assign rating_decimal = 0 
              assign decimal = product.metafields.reviews.rating.value.rating | modulo: 1 
              if decimal >= 0.3 and decimal <= 0.7
                assign rating_decimal = 0.5
              elsif decimal > 0.7
                assign rating_decimal = 1
              endif 
            -%}
            <div class="card__rating" role="img" aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: product.metafields.reviews.rating.value, rating_max: product.metafields.reviews.rating.value.scale_max }}">
              <span aria-hidden="true" class="rating-star" style="--rating: {{ product.metafields.reviews.rating.value.rating | floor }}; --rating-decimal: {{ rating_decimal }}"></span>
              <span class="rating-text caption">
                {{ product.metafields.reviews.rating_count }} {{ 'accessibility.total_reviews' | t: count: product.metafields.reviews.rating_count }}
              </span>
            </div>
          {%- endif -%}

          <!-- Price -->
          {% render 'price', product: product, price_class: 'price--center' %}
        </div>
      </div>
    </div>
  </div>
</div>
